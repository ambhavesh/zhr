sap.ui.define(["./App.controller","../model/models","../formatter/formatter","sap/ui/core/Fragment","sap/m/MessageBox"],(e,t,s,r,a)=>{"use strict";return e.extend("zleaverequest.controller.Main",{formatter:s,onInit:async function(){this.getModel().setUseBatch(false);var e=this.getModel("LeaveModel");e.setProperty("/PriorityItems",t.getPriorityItems());e.setProperty("/TypeItems",t.getLeaveTypeItems());await this.getUserDetails();this.getLeaveRequest();this.getRouter().getRoute("RouteMain").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){this.getLeaveRequest()},getUserDetails:function(){return new Promise((e,t)=>{var s;var r=sap.ushell;if(r){s=sap.ushell.Container.getService("UserInfo").getEmail()}if(s===undefined){s="tiwaribhavesh45@gmail.com"}var o=this.getModel();o.callFunction("/GetLoggedInUser",{urlParameters:{Email:s},success:t=>{e(t);this.getModel("LeaveModel").setProperty("/User",t.results);this.getModel("LeaveModel").setProperty("/EmpId",t.results[0].EMP_ID)},error:e=>{t(e);a.error("Failed to load, Instance is crashed or stopped",{title:"Error"})}})})},getLeaveRequest:function(){var e=this.getModel("LeaveModel").getProperty("/EmpId");var t=this.getFilter("APPLIED_BY_EMP_ID",sap.ui.model.FilterOperator.EQ,e);var s=this.getModel();this.setBusy(this.byId("LeaveRequestList"));s.read("/LeaveRequests",{filters:[t],urlParameters:{$expand:"APPLIED_BY"},success:e=>{this.hideBusy(this.byId("LeaveRequestList"));this.getModel("LeaveModel").setProperty("/LeaveRequestItem",e.results);this.getModel("LeaveModel").setProperty("/RequestCount",e.results.length)},error:e=>{a.error("Failed to load, Instance is crashed or stopped",{title:"Error"})}})},onCreateRequestPress:function(){var e=t.getLeaveRequestPayload();this.getModel("LeaveModel").setProperty("/CreateLeaveRequestPayload",e);var s=this.getView();var a=this;if(!this.oLeaveRequestDialog){this.oLeaveRequestDialog=r.load({id:s.getId(),name:"zleaverequest.fragments.CreateLeaveRequest",controller:this}).then(function(e){a.oLeaveRequestDialog=e;s.addDependent(e);e.open();return e})}else{this.oLeaveRequestDialog.open()}},onLeaveRequestDialogCancelPress:function(){this.oLeaveRequestDialog.close();if(this.oLeaveRequestDialog){this.oLeaveRequestDialog.destroy();this.oLeaveRequestDialog=null}},onLeaveRequestSavePress:function(){var e=this.getModel("LeaveModel");var t=e.getProperty("/CreateLeaveRequestPayload");t.APPLIED_BY_EMP_ID=e.getProperty("/EmpId");t.FROM_DATE=t.DATE.split(" - ")[0];t.TO_DATE=t.DATE.split(" - ")[1];delete t.DATE;sap.ui.core.BusyIndicator.show();this.getModel().create("/LeaveRequests",t,{success:e=>{this.getLeaveRequest();this.onLeaveRequestDialogCancelPress();this.getModel("LeaveModel").refresh();sap.ui.core.BusyIndicator.hide()},error:function(e){a.error("Failed to create, Instance is crashed or stopped",{title:"Error"})}})},onLeaveRequestSelectionChange:function(e){var t=this.getModel("LeaveModel");var s=e.mParameters.listItem;s.setSelected(false);var r=s.getBindingContext("LeaveModel").getObject();t.setProperty("/SelectedLeaveRequestObj",r);r.STATUS==="Pending"?t.setProperty("/EnabledForModify",true):t.setProperty("/EnabledForModify",false);this.getRouter().navTo("LeaveRequest",{LeaveRequestId:r.LEAVE_REQUEST_ID})}})});
//# sourceMappingURL=Main.controller.js.map